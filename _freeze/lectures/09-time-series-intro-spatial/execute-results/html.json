{
  "hash": "d75bf928be461b3261ed60a3f1d57146",
  "result": {
    "markdown": "---\ntitle: \"Time series and intro to spatial data\"\nauthor: \"Prof Ron Yurko\"\nfooter:  \"[mads-36613-fall24](https://ryurko.github.io/mads-36613-fall24/)\"\ndate: 2024-09-25\nengine: knitr\nformat:\n  revealjs:\n    theme: theme.scss\n    chalkboard: true\n    pdf-separate-fragments: true\n    slide-number: c/t\n    smaller: true\n    code-line-numbers: true\n    linestretch: 1.25\n    html-math-method:\n      method: mathjax\n      url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\n---\n\n\n\n\n\n## Reminders, previously, and today...\n\n+ **HW4 is due TONIGHT Sept 25th** \n\n+ **You need to email me a draft of your EDA report!** (1 per group)\n\n. . .\n\n+ Walked through non-linear dimension reduction with t-SNE\n\n+ Discussed visualizing trends, highglighting points of emphasis\n\n. . .\n\n**TODAY:**\n\n+ Walk through the basics of time series data techniques\n\n+ Introduce visualizations and inference with spatial data\n\n---\n\n## Things of interest for time series data\n\nTime series can be characterized by three features:\n\n1. __Trends__: Does the variable increase or decrease over time, on average?\n\n2. __Seasonality__: Are there changes in the variable that regularly happen (e.g., every winter, every hour, etc.)? Sometimes called periodicity.\n\n3. __Noise__: Variation in the variable beyond average trends and seasonality.\n\n**Moving averages are a starting point for visualizing how a trend changes over time**\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://www.ft.com/__origami/service/image/v2/images/raw/https%3A%2F%2Fd6c748xw2pzm8.cloudfront.net%2Fprod%2Fc7ce2780-2f14-11eb-8e8a-cdb0723f9e68-standard.png?dpr=1&fit=scale-down&quality=highest&source=next&width=700){fig-align='center' width=80%}\n:::\n:::\n\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://icharts.coinlore.com/img/simple-moving-averages-ftx-token.jpg?time=1680119681){fig-align='center'}\n:::\n:::\n\n\n\n---\n\n## Be responsible with your axes!\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://cdn.sisense.com/wp-content/uploads/National-Review-Climate-Change-770x689.png){fig-align='center' width=50%}\n:::\n:::\n\n\n\n---\n\n## Be responsible with your axes!\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](http://www.washingtonpost.com/blogs/the-fix/files/2015/12/NRO_Temp_1.jpg){fig-align='center' width=50%}\n:::\n:::\n\n\n\n---\n\n## Moving Average Plots\n\nThe _Financial Times_ COVID-19 plots displayed a __moving average__ (sometimes called a __rolling average__)\n\n**Intuition**\n\n1. Divide your data into small subsets (\"windows\")\n\n2. Compute the average within each window\n\n3. Connect the averages together to make a trend line\n\n. . .\n\nSometimes called a __simple moving average__\n\nThis is exactly what we did with LOESS... we called this a _sliding window_, but it's the same thing\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-9-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-10-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-11-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n## How are moving averages computed?\n\n**Intuition**\n\n1. Divide your data into small subsets (_windows_)\n\n2. Compute the average within each window\n\n3. Connect the averages together to make a trend line\n\n. . .\n\nMathematically, a moving average can be written as the following:\n\n$$\\mu_k = \\frac{\\sum_{t=k - h + 1}^k X_t}{h}$$\n\n+ Large $h$: Smooth line; captures global trends\n\n+ Small $h$: Jagged/volatile line; captures local trends\n\n\n---\n\n## Working with Time Series\n\n`co2`: Mauna Loa Atmospheric CO2 Concentration dataset (monthly $\\text{CO}^2$ concentration 1959 to 1997)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nco2_tbl |>\n  ggplot(aes(x = obs_i, y = co2_val)) + \n  geom_line() + \n  labs(x = \"Time index\", y = \"CO2 (ppm)\")\n```\n\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-12-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n---\n\n## Formatting Dates\n\nCan use `as.Date()` to create time indexes.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=960}\n:::\n:::\n\n\nDefault format is Year/Month/Day. For something else, need to specify `format` in `as.Date()` (e.g., `format = \"%m/%d/%Y\"`)\n\n---\n\n## Use `scale_x_date()` to create interpretable axis labels \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-14-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n### Use [`ggseas`](https://cran.r-project.org/web/packages/ggseas/vignettes/ggseas.html) package to plot moving averages\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggseas)\nco2_tbl |> \n  ggplot(aes(x = obs_date, y = co2_val)) + geom_line(color = \"red\") + \n  stat_rollapplyr(width = 12, align = \"right\") +\n  labs(x = \"Year\", y = \"CO2 (ppm)\", title = \"Width = 12\")\n```\n\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-15-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-17-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n## Other Moving Averages\n\n\nTwo other common averages: Cumulative moving averages and weighted moving averages.\n\n+ __Cumulative moving average__: The average at time $k$ is the average of all points at and before $k$. Mathematically:\n\n$$\\mu_k^{(CMA)} = \\frac{\\sum_{t=1}^k X_t}{k}$$\n\n. . .\n\n+ __Weighted moving average__: Same as simple moving average, but different measurements get different weights for the average.\n\n$$\\mu_k^{(WMA)} = \\frac{\\sum_{t=k - h + 1}^k X_t \\cdot w_t}{ \\sum_{t=k - h + 1}^k w_t}$$\n\n\n---\n\n## Working with lags\n\nTime series data is fundamentally different from other data problems we've worked with because measurements are  __not independent__\n\nObvious example: The temperature today is correlated with temperature yesterday. (_Maybe not in Pittsburgh?_)\n\n. . .\n\nImportant term: __lags__. Used to determine if one time point influences future time points.\n\nLag 1: Comparing time series at time $t$ with time series at time $t - 1$. \n\nLag 2: Comparing time series at time $t$ with time series at time $t - 2$.\n\nAnd so on...\n\n. . .\n\nLet's say we have time measurements $(X_1, X_2, X_3, X_4, X_5)$. \n\nThe $\\ell = 1$ lag is $(X_2, X_3, X_4, X_5)$ vs $(X_1, X_2, X_3, X_4)$. \n\n. . .\n\nThe $\\ell = 2$ lag is $(X_3, X_4, X_5)$ vs $(X_1, X_2, X_3)$.\n\nConsider: Are previous outcomes (lags) predictive of future outcomes?\n\n---\n\n## Autocorrelation\n\n__Autocorrelation__: Correlation between a time series and a lagged version of itself.\n\nDefine $r_{\\ell}$ as the correlation between a time series and Lag $\\ell$ of that time series.\n\n. . .\n\nLag 1: $r_1$ is correlation between $(X_2, X_3, X_4, X_5)$ and $(X_1,X_2,X_3,X_4)$ \n\nLag 2: $r_2$ is correlation between $(X_3, X_4, X_5)$ and $(X_1,X_2,X_3)$\n\nAnd so on...\n\n. . .\n\nCommon diagnostic: Plot $\\ell$ on x-axis, $r_{\\ell}$ on y-axis.\n\nTells us if correlations are \"significantly large\" or \"significantly small\" for certain lags\n\nTo make an autocorrelation plot, we use the `acf()` function; the `ggplot` version uses `autoplot()`\n\n---\n\n## Autocorrelation plots\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggfortify)\nauto_corr <- acf(co2_tbl$co2_val, plot = FALSE)\nautoplot(auto_corr)\n```\n\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-18-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n### Autocorrelation Plots and Seasonality\n\nWith strong global trends, autocorrelations will be very positive.\n\n. . .\n\n**Helpful: Visualize autocorrelations after removing the global trend (compute moving average with `rollapply()`)**\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-19-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n## Autocorrelation Plots and Seasonality\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-20-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n---\n\n### Seasonality Decomposition\n\nRemember that there are three main components to a time series:\n\n1. Average trends\n\n2. Seasonality\n\n3. Noise\n\n. . .\n\nUse `ggsdc()` (from [`ggseas`](https://cran.r-project.org/web/packages/ggseas/vignettes/ggseas.html)) to decompose a time series into these three components\n\n+ Plots the observed time series.\n\n+ Plots a loess curve as the global trend.\n\n+ Plots another loess curve on (observed - trend) as the seasonality.\n\n+ Plots the noise (observed - trend - seasonality).\n\n---\n\n### Seasonality Decomposition\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nco2_tbl |>\n  ggsdc(aes(obs_date, co2_val), frequency = 12, method = \"stl\", s.window = 12) +\n  geom_line() + labs(x = \"Year\", y = \"CO2 (ppm)\")\n```\n\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-21-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n## How should we think about spatial data?\n\nTypically location is measured with __latitude__ / __longitude__ (2D)\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n- __Latitude__: Measures North / South (the \"y-axis\")\n\n  - Range is $(-90^{\\circ}, 90^{\\circ})$\n  \n  - Measures degrees from the equator $(0^{\\circ})$\n  \n  - $(-90^{\\circ}, 0^{\\circ})$ = southern hemisphere \n  \n  - $(0^{\\circ}, 90^{\\circ})$ = northern hemisphere \n\n:::\n\n::: {.column width=\"50%\"}\n\n- __Longitude__: Measures East/West (the \"x-axis\")\n\n  - Range is $(-180^{\\circ}, 180^{\\circ})$\n  \n  - Measures degrees from the prime meridian $(0^{\\circ})$ in Greenwich, England\n  \n  - $(-180^{\\circ}, 0^{\\circ})$ = eastern hemisphere\n  \n  - $(0^{\\circ}, 180^{\\circ})$ = western hemisphere\n\n:::\n\n::::\n\n\n---\n\n## Latitude and Longitude\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://c.tadst.com/gfx/1200x630/longitude-and-latitude-simple.png?1){fig-align='center' width=80%}\n:::\n:::\n\n\n---\n\n## Map Projections\n\n__Map projections__: Transformation of the lat / long coordinates on a sphere (the earth) to a 2D plane\n  \n- There are many different projections - each will distort the map in different ways.\n\n- The most common projections are:\n\n  - [Mercator](https://en.wikipedia.org/wiki/Mercator_projection)\n  \n  - [Robinson](https://en.wikipedia.org/wiki/Robinson_projection)\n  \n  - [Conic](http://www.geo.hunter.cuny.edu/~jochen/gtech201/lectures/lec6concepts/Map%20coordinate%20systems/Conic%20projections.htm#:~:text=Conic%20projections%20are%20created%20by,a%20developable%20map%20projection%20surface.)\n  \n  - [Cylindrical](https://en.wikipedia.org/wiki/Map_projection#Cylindrical)\n  \n  - [Planar](http://www.geo.hunter.cuny.edu/~jochen/gtech201/lectures/lec6concepts/Map%20coordinate%20systems/Planar%20projections.htm)\n  \n  - [Interrupted projections](https://en.wikipedia.org/wiki/Interruption_(map_projection))\n\n\n---\n\n## Mercator Projection (1500s)\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Mercator_projection_Square.JPG/700px-Mercator_projection_Square.JPG){fig-align='center' width=60%}\n:::\n:::\n\n\n\n---\n\n## Mercator Projection (Tissot indicatrix)\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Mercator_with_Tissot%27s_Indicatrices_of_Distortion.svg/700px-Mercator_with_Tissot%27s_Indicatrices_of_Distortion.svg.png){fig-align='center' width=60%}\n:::\n:::\n\n\n\n---\n\n## Robinson Projection (Standard from 1963-1998)\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Robinson_projection_SW.jpg/700px-Robinson_projection_SW.jpg){fig-align='center' width=70%}\n:::\n:::\n\n\n\n---\n\n## Robinson Projection (Tissot indicatrix)\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Robinson_with_Tissot%27s_Indicatrices_of_Distortion.svg/700px-Robinson_with_Tissot%27s_Indicatrices_of_Distortion.svg.png){fig-align='center' width=70%}\n:::\n:::\n\n\n\n---\n\n## Winkel Tripel Projection (proposed 1921, now the standard)\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Winkel_triple_projection_SW.jpg/660px-Winkel_triple_projection_SW.jpg){fig-align='center' width=60%}\n:::\n:::\n\n\n---\n\n## Winkel Tripel Projection (Tissot indicatrix)\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Winkel_Tripel_with_Tissot%27s_Indicatrices_of_Distortion.svg/660px-Winkel_Tripel_with_Tissot%27s_Indicatrices_of_Distortion.svg.png){fig-align='center' width=60%}\n:::\n:::\n\n\n---\n\n## And many more... (see [xkcd comic](https://xkcd.com/977/))\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://i.pinimg.com/originals/2d/03/cf/2d03cffa216afb23fa50fb07fc1221b1.jpg){fig-align='center' width=60%}\n:::\n:::\n\n\n\n---\n\n## Visualizing spatial data on maps using [`ggmap`](https://cran.r-project.org/web/packages/ggmap/readme/README.html)\n\n\n::: {.cell layout-align=\"center\" output-location='slide'}\n\n```{.r .cell-code}\nlibrary(ggmap)\n# First, we'll draw a \"box\" around the US (in terms of latitude and longitude)\nUS <- c(left = -125, bottom = 10, right = -67, top = 49)\nmap <- get_stadiamap(US, zoom = 5, maptype = \"stamen_toner_lite\")\n\n# Visualize the basic map\nggmap(map)\n```\n\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-30-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n- Draw map based on lat / lon coordinates\n\n- Put the box into `get_stadiamap()` to access [Stamen Maps](http://maps.stamen.com/#terrain/12/37.7706/-122.3782) (__you need an API key!__)\n\n- Draw the map using `ggmap()` to serve as base\n\n\n---\n\n## Three main types of spatial data\n\n\n1. __Point Pattern Data__: lat-long coordinates where events have occurred\n\n2. __Point-Referenced data__: Latitude-longitude (lat-long) coordinates as well as one or more variables specific to those coordinates.\n\n3. __Areal Data__: Geographic regions with one or more variables associated with those regions.\n\n. . .\n\n- Each type is structured differently within a dataset\n\n- Each type requires a different kind of graph(s)\n\n. . .\n\nWe're going to review each type of data. Then, we're going to demonstrate how to plot these different data types\n\n+ __Today: Point-referenced and point pattern__\n\n+ Monday: Areal data\n\n---\n\n## Point-Pattern data\n\n- __Point Pattern Data__: lat-long coordinates where events have occurred\n\n- __Point pattern data simply records the lat-long of events__; thus, there are only two columns\n\n- Again, latitude and longitude are represented with dots, sometimes called a dot or bubble map.\n\n. . .\n\n- The goal is to understand how the __density__ of events varies across space\n\n- The density of the dots can also be visualized (e.g., with contours)\n\n  - __Use methods we've discussed before for visualizing 2D joint distribution__\n\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](https://static01.nyt.com/images/2020/09/10/learning/TotalCovidMap-LN/TotalCovidMap-LN-superJumbo.png?quality=75&auto=webp){fig-align='center' width=80%}\n:::\n:::\n\n\n\n---\n\n## Point-Referenced data\n\n- __Point-Referenced data__: Latitude-longitude (lat-long) coordinates as well as one or more variables specific to those coordinates\n\n- Point-referenced data will have the following form:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nairports |> dplyr::select(lat, lon, altitude, n_depart, n_arrive, name) |> slice(1:3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 Ã— 6\n    lat   lon altitude n_depart n_arrive name                        \n  <dbl> <dbl>    <dbl>    <int>    <int> <chr>                       \n1 -6.08  145.     5282        5        5 Goroka Airport              \n2 -5.21  146.       20        8        8 Madang Airport              \n3 -5.83  144.     5388       10       12 Mount Hagen Kagamuga Airport\n```\n:::\n:::\n\n\n. . .\n\n- The goal is to understand how the variable(s) (e.g., `altitude`) vary across different spatial locations\n\n- Typically, the latitude and longitude are represented with dots, and the variable(s) are represented with size and/or colors\n\n---\n\n## Adding points to the map as usual\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggmap(map) +\n  geom_point(data = airports, aes(x = lon, y = lat), alpha = 0.25)\n```\n\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-33-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n---\n\n## Altering points on the map (in the usual way)\n\n\n::: {.cell layout-align=\"center\" output-location='slide'}\n\n```{.r .cell-code}\nggmap(map) +\n  geom_point(data = airports, \n             aes(x = lon, y = lat, \n                 size = sqrt(n_depart), color = sqrt(n_arrive)),\n             alpha = .5) +\n  scale_size_area(breaks = sqrt(c(1, 5, 10, 50, 100, 500)), \n                  labels = c(1, 5, 10, 50, 100, 500), \n                  name = \"# departures\") +\n  scale_color_distiller(palette = \"Spectral\") +\n  labs(color = \"sqrt(# arrivals)\") +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-34-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n## Inference for Spatial Data\n\nThere are whole courses, textbooks, and careers dedicated to this. We're not going to cover everything!\n\nHowever, there are some straightforward analyses that can be done for spatial data.\n\n**Point-Referenced Data:**\n\n+ Divide geography into groups (e.g., north/south/east/west) and use regression to test if there are significant differences.\n\n+ Regression of $\\text{outcome} \\sim \\text{latitude} + \\text{longitude}$. Smoothing regression (e.g., loess) is particularly useful here.\n\n---\n\n## Visualizing Inference for Point-Reference Data\n\nFor basic linear regression:\n\n1. Plot $(x, y)$ as points\n\n2. Fit the regression model $y \\sim x$, to give us  $\\hat{y} = \\hat{\\beta}_0 + \\hat{\\beta}_1 \\cdot x$\n\n3. Plot $(x, \\hat{y})$ as a line\n\n. . .\n\nFor point reference data, we have the following variables:\n\n+ Inputs are longitude $x$ and latitude $y$, and outcome variable is $z$\n\nConsider the following linear regression model: $z \\sim \\text{lat} + \\text{long}$\n\nGoal: Make a visual involving $(\\text{long}, \\text{lat}, \\hat{z})$, and possibly $z$.\n\n\n---\n\n## Kriging\n\nGoal: Make a visual involving (long, lat, $\\hat{z}$) and possibly $z$\n\nWant $\\hat{z}$ for many (long, lat) combos (not just the observed one!)\n\nTo do this, follow this procedure:\n\n1. Fit the model $z \\sim \\text{lat} + \\text{long}$\n\n2. Create a grid of $(\\text{long}, \\text{lat})_{ij}$\n\n3. Generate $\\hat{z}_{ij}$ for each $(\\text{long}, \\text{lat})_{ij}$\n\n4. Plot a heat map or contour plot of (long, lat, $\\hat{z}$)\n\n+ You can also add the actual $z$ values (e.g., via size) on the heat map\n\nThis is known as **kriging**, or _spatial interpolation_\n\n---\n\n## Kriging: airline data example\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-35-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n---\n\n## Kriging: creating the map\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-36-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n## Kriging: generating the grid\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-37-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n---\n\n\n## Kriging: generating predicted values\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-38-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n## Kriging: plotting heat map of predicted values\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](09-time-series-intro-spatial_files/figure-revealjs/unnamed-chunk-39-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n---\n\n## Kriging overview\n\n\nThe steps used to create this map are...\n\n1. Fit an interactive regression model using `loess()`\n\n2. Make a grid of lat/long coordinates, using `seq()` and `expand.grid()`\n\n3. Get estimated outcomes across the grid using `predict()`\n\n4. Use `geom_contour_filled()` to color map by estimated outcomes\n\n\n---\n\n## Recap and next steps\n\n+ Walked through basics of time series data, such as moving averages, autocorrelation, seasonality\n\n+ Visualized spatial data in a 2D plane (latitude/longitude), i.e., maps\n\n  + Point pattern: Scatterplots with density contours\n\n  + Point-referenced: Scatterplots with color/size, use regression/loess for inference\n\n. . .\n\n+ **HW4 is due TONIGHT!** **Email me a draft of your EDA report!** (1 per group)\n\n+ **Next time**: Visualizing areal data and creating high-quality graphics\n\n+ [CW CH 13 Visualizing time series and other functions of an independent variable](https://clauswilke.com/dataviz/time-series.html), [CW CH 14 Visualizing trends](https://clauswilke.com/dataviz/visualizing-trends.html), [CW Chapter 15 Visualizing geospatial data](https://clauswilke.com/dataviz/geospatial-data.html), [KH Chapter 7 Draw Maps](https://socviz.co/maps.html#maps)\n\n\n\n\n",
    "supporting": [
      "09-time-series-intro-spatial_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}